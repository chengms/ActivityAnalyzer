# 活动分析器 - 功能要点

## 📋 核心功能模块

### 0. 设置管理模块 (Settings) ✅

**功能描述：** 管理应用配置和用户偏好设置

**具体功能点：**
- ✅ **检测间隔设置**：可设置 1-60 秒的检测间隔
- ✅ **开机自启动**：支持 Windows 注册表自动启动
- ✅ **启动行为**：启动时最小化选项
- ✅ **窗口行为**：最小化到托盘、关闭到托盘
- ✅ **设置持久化**：JSON 文件存储用户设置
- ✅ **实时应用**：设置更改后立即生效

**设置项：**
- `checkInterval`: 检测间隔（毫秒，默认 5000）
- `autoStart`: 开机自启动（默认 false）
- `startMinimized`: 启动时最小化（默认 false）
- `minimizeToTray`: 最小化到托盘（默认 true）
- `closeToTray`: 关闭到托盘（默认 true）

**系统托盘功能：**
- ✅ 系统托盘图标显示
- ✅ 右键菜单：显示窗口、设置、退出
- ✅ 双击托盘图标显示窗口
- ✅ 后台运行支持

**开机自启动：**
- ✅ Windows 注册表集成
- ✅ 自动检测当前状态
- ✅ 一键启用/禁用

### 1. 活动追踪模块 (Activity Tracker) ✅

**功能描述：** 实时监控和记录用户的电脑活动

**具体功能点：**
- ✅ **实时监控**：每 5 秒检查一次活动窗口变化
- ✅ **应用识别**：获取当前活动应用的进程名称
- ✅ **窗口标题**：记录活动窗口的标题信息
- ✅ **时间记录**：记录活动的开始时间、结束时间和持续时间
- ✅ **自动保存**：应用或窗口切换时自动保存记录
- ✅ **数据过滤**：忽略小于 1 秒的短暂活动

**技术实现：**
- Windows 平台使用 PowerShell 调用 Windows API
- `GetForegroundWindow()` 获取活动窗口句柄
- `GetWindowThreadProcessId()` 获取进程 ID
- `GetWindowText()` 获取窗口标题
- **动态检测间隔**：支持运行时修改检测间隔
- **设置驱动**：检测间隔从设置模块读取

**数据记录字段：**
- `appName`: 应用名称（进程名）
- `windowTitle`: 窗口标题
- `startTime`: 开始时间（ISO 格式）
- `endTime`: 结束时间（ISO 格式）
- `duration`: 持续时间（秒）
- `date`: 日期（YYYY-MM-DD）

---

### 2. 数据存储模块 (Database) ✅

**功能描述：** 使用 SQLite 数据库持久化存储活动数据

**具体功能点：**
- ✅ **数据库初始化**：自动创建表结构和索引
- ✅ **数据插入**：插入新的活动记录
- ✅ **数据更新**：更新活动记录的结束时间和时长
- ✅ **按日期查询**：获取指定日期的所有活动记录
- ✅ **应用使用统计**：统计指定时间范围内各应用的使用情况
- ✅ **每日汇总**：生成指定日期的活动汇总数据

**数据库结构：**
```sql
activities 表：
- id: 主键
- appName: 应用名称
- windowTitle: 窗口标题
- startTime: 开始时间
- endTime: 结束时间
- duration: 持续时间（秒）
- date: 日期
- createdAt: 创建时间
```

**索引优化：**
- `idx_date`: 日期索引
- `idx_appName`: 应用名称索引
- `idx_startTime`: 开始时间索引

**查询接口：**
- `getActivityByDate(date)`: 获取指定日期的活动记录
- `getAppUsage(startDate, endDate)`: 获取应用使用统计
- `getDailySummary(date)`: 获取每日汇总

---

### 3. 数据分析模块 (Analyzer) ⚠️

**功能描述：** 分析活动数据，提供统计和洞察

**当前状态：** 部分功能已集成到 UI 和数据库模块中

**已实现功能：**
- ✅ **应用使用排行**：按使用时长排序
- ✅ **使用次数统计**：统计每个应用的使用次数
- ✅ **总时长计算**：计算总使用时长
- ✅ **应用数量统计**：统计使用的应用总数

**待扩展功能：**
- ⏳ **时间段分析**：按小时、时间段分析活动模式
- ⏳ **趋势分析**：多日数据对比和趋势
- ⏳ **分类统计**：按应用类型分类统计
- ⏳ **效率分析**：识别高效/低效时间段

---

### 4. 数据可视化模块 (UI Components) ✅

**功能描述：** 通过图表和列表展示活动数据

**具体功能点：**

#### 4.1 仪表板 (Dashboard)
- ✅ **日期选择器**：选择要查看的日期
- ✅ **汇总卡片**：显示总使用时长、应用数、记录数
- ✅ **实时数据加载**：根据选择的日期动态加载数据

#### 4.2 应用使用时长分布图 (ActivityChart)
- ✅ **饼图展示**：使用 Chart.js Doughnut 图表
- ✅ **前 10 应用**：显示使用时长最多的 10 个应用
- ✅ **交互提示**：鼠标悬停显示详细时长信息
- ✅ **颜色区分**：不同应用使用不同颜色

#### 4.3 应用使用排行列表 (AppUsageList)
- ✅ **排名显示**：显示应用使用排名
- ✅ **进度条**：可视化显示使用时长占比
- ✅ **使用次数**：显示每个应用的使用次数
- ✅ **时长格式化**：自动转换为小时/分钟格式

#### 4.4 活动时间线 (ActivityTimeline)
- ✅ **时间顺序**：按时间倒序显示活动记录
- ✅ **详细信息**：显示应用名、窗口标题、时长
- ✅ **时间格式化**：友好的时间显示格式
- ✅ **记录限制**：最多显示 20 条记录

---

### 5. 报告生成模块 (Reporter) ✅

**功能描述：** 生成可导出的活动分析报告

**具体功能点：**

#### 5.1 Excel 报告 ✅
- ✅ **多工作表**：包含汇总、应用统计、详细记录三个工作表
- ✅ **数据格式化**：时长自动转换为小时/分钟格式
- ✅ **排序功能**：应用使用统计按时长降序排列
- ✅ **完整记录**：包含所有活动记录的详细信息

**Excel 报告结构：**
1. **汇总表**：日期、总时长、应用数、记录数
2. **应用使用统计表**：应用名、使用时长、使用次数
3. **详细记录表**：开始时间、结束时间、应用名、窗口标题、时长

#### 5.2 HTML 报告 ✅
- ✅ **可视化展示**：美观的 HTML 格式报告
- ✅ **汇总卡片**：显示关键统计指标
- ✅ **表格展示**：应用排行和详细记录表格
- ✅ **响应式设计**：适配不同屏幕尺寸
- ✅ **样式优化**：现代化的 UI 设计

**HTML 报告内容：**
- 日期汇总信息
- 应用使用排行表格
- 详细活动记录表格
- 报告生成时间

**报告存储位置：**
- 存储在 `{userData}/reports/` 目录
- 文件命名：`活动报告_YYYY-MM-DD.xlsx` / `.html`

---

## 🔄 数据流程

```
1. 活动追踪器 (Tracker)
   ↓ 每 5 秒检查
   ↓ 检测到变化
   ↓
2. 数据库 (Database)
   ↓ 保存/更新记录
   ↓
3. 前端界面 (Renderer)
   ↓ 用户选择日期
   ↓ 请求数据
   ↓
4. 数据展示
   ↓ 图表/列表/时间线
   ↓
5. 报告生成 (Reporter)
   ↓ 用户点击生成报告
   ↓ Excel/HTML 文件
```

---

## 📊 界面功能

### 主界面布局
1. **顶部导航栏**
   - 应用标题
   - 日期选择器
   - 生成报告按钮

2. **汇总卡片区域**
   - 总使用时长
   - 使用应用数
   - 活动记录数

3. **图表区域**
   - 应用使用时长分布饼图

4. **内容网格区域**
   - 左侧：应用使用排行列表
   - 右侧：活动时间线

---

## 🎯 核心特性

### ✅ 已实现
- [x] 实时活动追踪（Windows 平台）
- [x] SQLite 数据持久化
- [x] 数据可视化（图表、列表、时间线）
- [x] 日期筛选和查询
- [x] Excel 报告生成
- [x] HTML 报告生成
- [x] 应用使用统计
- [x] 每日活动汇总

### ✅ 新增功能（已实现）
- [x] **后台运行**：系统托盘支持，应用可在后台运行
- [x] **开机自启动**：支持设置开机自动启动
- [x] **检测间隔设置**：可自定义活动检测的时间间隔（1-60秒）
- [x] **窗口行为设置**：最小化到托盘、关闭到托盘
- [x] **设置界面**：完整的设置管理界面

### ⏳ 待实现/可扩展
- [ ] 多平台支持（macOS、Linux）
- [ ] 时间段分析（按小时、时间段）
- [ ] 多日数据对比
- [ ] 数据导出（CSV、JSON）
- [ ] 数据筛选和搜索
- [ ] 应用分类和标签
- [ ] 活动目标设置
- [ ] 提醒和通知功能
- [ ] 数据备份和恢复
- [ ] 隐私模式（暂停追踪）

---

## 🔧 技术要点

### 架构设计
- **主进程**：Electron 主进程，负责追踪和数据处理
- **渲染进程**：React 前端，负责 UI 展示
- **IPC 通信**：通过 contextBridge 安全通信
- **数据库**：better-sqlite3 同步数据库操作

### 性能优化
- 数据库索引优化查询速度
- 定期检查而非实时监控（5 秒间隔）
- 前端组件懒加载
- 数据分页显示（时间线最多 20 条）

### 安全性
- contextIsolation 启用
- nodeIntegration 禁用
- 通过 preload 脚本暴露安全 API

---

## 📝 使用场景

1. **个人时间管理**：了解自己每天在哪些应用上花费时间
2. **工作效率分析**：分析工作时间和应用使用模式
3. **习惯追踪**：追踪特定应用的使用习惯
4. **报告生成**：生成每日/每周活动报告
5. **数据导出**：导出数据用于进一步分析

---

## 🚀 未来规划

1. **增强分析功能**
   - 时间段热力图
   - 应用使用趋势图
   - 效率评分系统

2. **用户体验优化**
   - 深色模式
   - 自定义主题
   - 快捷键支持

3. **数据管理**
   - 数据清理工具
   - 数据导入/导出
   - 多设备同步（可选）

4. **智能功能**
   - 活动分类自动识别
   - 异常活动检测
   - 使用建议和提醒

